# About:

This is an Stm32 project template that uses Rake, rather than Make, for its build tool.

# Why switch to Rake?:

Rake is an **internal** Domain Specific Language (DSL) which gives it an advantage to traditional build tools like Make. Rake has the full power of the Ruby programming language behind it. This allows you to easily integrate interesting tasks and scripts into your project. Consolidating your build tool into a general purpose programming language means easier installation, unified functionality, and one less language to remember.

# Getting Started:

## Windows Setup Instructions:

1. Install [Ruby](https://rubyinstaller.org/)

2. Install latest Ruby Rake gem:

    `gem install rake`

3. Install [Arm GCC](https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads). Ensure the path to `arm-none-eabi-gcc.exe` is added to your PATH system environment variable.

4. Verify arm-none-eabi-gcc command is recognized in command prompt:

    `arm-none-eabi-gcc --version`

5. Install [ST-Link](https://github.com/stlink-org/stlink/releases/). Ensure the path to `st-flash.exe` is added to your PATH system environment variable.

6. Verify st-flash command is recognized in command prompt:

    `st-flash --version`

## OSX Setup Instructions:

TBD

## Linux Setup Instructions:

1. Install Ruby:

    `sudo apt install ruby`

2. Install latest Ruby Rake gem:

    `sudo gem install rake`

3. Install Arm GCC:

    `sudo apt install gcc-arm-none-eabi`

4. Install ST-Link:

    `sudo apt install stlink-tools`


# List All Tasks:

    rake --tasks

# Example:

Build debug HEX image:

    rake debug:hex

Flash debug HEX image to target:

    rake stlink:flash:debug

# Porting Scaffold to Other STM32Fx Targets:

While STM32F303RE is the defaulted target, you can use STMCubeMX to generate code for any other STM32Fx device. See the `.ioc` project file in the repository. After generating code with STMCubeMX, refer to the table below to copy the variable content from the generated Makefile to the variable in the Rakefile.

| Makefile | Rakefile |
|-|-|
| C_SOURCES | SOURCES |
| ASM_SOURCES | SOURCES |
| C_INCLUDES | INCLUDES |
| C_DEFS | DEFINES |
| MCU | TARGET[:mcu_args] |
| FPU | TARGET[:mcu_args] |
| FLOAT-ABI | TARGET[:mcu_args] |
| LDSCRIPT | TARGET[:ld_script] |

Once the Rakefile works you can remove the Makefile from the project.

# Licensing:

Please note this projects license does not cover:

* Any drivers/modules in the `drivers` folder.
* Any code generated by STMCubeMX.

Please refer to the specific licensing of that project/driver/module.

# Acknowledgements:

ADVI.CODES - [Rake Tutorials](https://avdi.codes/tag/rake)

ElectronVector - [blog-rake-gcc-depends](https://github.com/ElectronVector/blog-rake-gcc-depends)

ThrowTheSwitch - [arduino_c_scaffold](https://github.com/ThrowTheSwitch/arduino_c_scaffold)







